<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Cliente</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-4">
    <h2 class="text-center mb-4">üîë Login Cliente</h2>

    <div class="card p-4">
        <form id="form-login-cliente">
            <div class="mb-3">
                <input type="email" id="email" class="form-control" placeholder="Digite seu email" required>
            </div>
            <button type="submit" class="btn btn-primary w-100">Receber C√≥digo</button>
        </form>
    </div>

    <!-- üîπ Campo para inserir c√≥digo -->
    <div class="card p-4 mt-3 d-none" id="codigo-container">
        <h4>Insira o C√≥digo</h4>
        <input type="text" id="codigo" class="form-control mb-2" placeholder="C√≥digo recebido" required>
        <button id="verificar-codigo" class="btn btn-success w-100">Entrar</button>
    </div>

    <script>
        let emailGlobal = "";

        document.getElementById("form-login-cliente").addEventListener("submit", async function(event) {
            event.preventDefault();
            emailGlobal = document.getElementById("email").value.trim();

            if (!emailGlobal) {
                alert("‚ö†Ô∏è Digite um email v√°lido!");
                return;
            }

            try {
                let response = await fetch("./api/api_login_cliente.php?acao=enviar_codigo", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email: emailGlobal })
                });

                let data = await response.json();

                if (data.mensagem) {
                    alert("üì© C√≥digo enviado para o email!");
                    document.getElementById("codigo-container").classList.remove("d-none");
                } else {
                    alert("‚ö†Ô∏è " + (data.erro || "Erro ao enviar c√≥digo!"));
                }
            } catch (error) {
                console.error("Erro ao enviar c√≥digo:", error);
                alert("‚ùå Erro ao enviar c√≥digo!");
            }
        });

        document.getElementById("verificar-codigo").addEventListener("click", async function() {
            let codigo = document.getElementById("codigo").value.trim();

            if (!codigo) {
                alert("‚ö†Ô∏è Digite o c√≥digo!");
                return;
            }

            try {
                let response = await fetch("./api/api_login_cliente.php?acao=verificar", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email: emailGlobal, codigo: codigo })
                });

                let data = await response.json();

                if (data.mensagem) {
                    alert("‚úÖ Login bem-sucedido!");
                    window.location.href = "loja/finalizar.html";  // üî• Agora vai para finalizar a compra
                } else {
                    alert("‚ö†Ô∏è C√≥digo inv√°lido!");
                }
            } catch (error) {
                console.error("Erro ao verificar c√≥digo:", error);
                alert("‚ùå Erro ao verificar c√≥digo!");
            }
        });
    </script>
</body>
</html>



